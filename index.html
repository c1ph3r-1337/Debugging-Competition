<!doctype html>
<html lang="en" class="dark">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>C++ Debugging Challenge</title>
		<link
			rel="icon"
			href="https://www.ctuniversity.in/images/logo/Ct_logo.png"
			type="image/png"
		/>
		<script src="https://cdn.tailwindcss.com"></script>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;700&display=swap"
			rel="stylesheet"
		/>
		<script src="https://unpkg.com/lucide@latest"></script>
		<style>
			body {
				font-family: "Inter", sans-serif;
				background-color: #020617; /* slate-950 */
				background-image: radial-gradient(
					circle at 1px 1px,
					#1e293b 1px,
					transparent 0
				);
				background-size: 2rem 2rem;
				position: relative; /* Needed for z-index context */
				z-index: 0;
			}
			/* Added for transparent background logo */
			body::before {
				content: "";
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background-image: url("https://www.ctuniversity.in/images/logo/Ct_logo.png");
				background-repeat: no-repeat;
				background-position: center;
				background-size: 50%; /* Adjust size as needed */
				opacity: 0.05; /* Lowered transparency */
				z-index: -1; /* Places it behind all content */
			}
			.font-mono {
				font-family: "Roboto Mono", monospace;
			}
			.card {
				background-color: rgba(
					15,
					23,
					42,
					0.8
				); /* slate-900 with opacity */
				border: 1px solid #1e293b; /* slate-800 */
				backdrop-filter: blur(10px);
				-webkit-backdrop-filter: blur(10px);
				transition: all 0.3s ease;
			}
			.card:hover {
				transform: translateY(-5px) scale(1.02);
				border-color: #06b6d4; /* cyan-500 */
				box-shadow: 0 0 25px rgba(6, 182, 212, 0.3);
			}
			.card.solved {
				border-color: #22d3ee; /* cyan-400 */
				box-shadow: 0 0 20px rgba(34, 211, 238, 0.5);
			}
			.card.solved:hover {
				transform: none;
				border-color: #22d3ee;
				box-shadow: 0 0 20px rgba(34, 211, 238, 0.5);
			}

			.tag-easy {
				background-color: #059669;
				color: #a7f3d0;
			} /* emerald-600, emerald-200 */
			.tag-intermediate {
				background-color: #d97706;
				color: #fef3c7;
			} /* amber-600, amber-100 */
			.tag-hard {
				background-color: #be123c;
				color: #fecdd3;
			} /* rose-700, rose-200 */

			.filter-btn {
				transition: all 0.2s ease-in-out;
			}
			.filter-btn.active {
				background-color: #0e7490; /* cyan-700 */
				color: #fff;
				box-shadow: 0 0 15px rgba(6, 182, 212, 0.5);
			}

			/* Modal Styles */
			#solver-modal {
				background-color: rgba(0, 0, 0, 0.7);
				backdrop-filter: blur(8px);
			}
			.code-editor {
				font-family: "Roboto Mono", monospace;
				background-color: #0f172a; /* slate-900 */
				color: #e2e8f0; /* slate-200 */
				border: 1px solid #334155; /* slate-700 */
				border-radius: 8px;
				min-height: 250px;
			}
			.output-area {
				font-family: "Roboto Mono", monospace;
				background-color: #020617; /* slate-950 */
				color: #94a3b8; /* slate-400 */
				border: 1px solid #334155; /* slate-700 */
				border-radius: 8px;
				min-height: 100px;
				white-space: pre-wrap;
				word-wrap: break-word;
			}

			/* Competition Start/End Styles */
			.content-blur {
				filter: blur(8px);
				transition: filter 0.3s ease-in-out;
			}
			#start-overlay,
			#disqualified-overlay {
				background-color: rgba(2, 6, 23, 0.9);
				backdrop-filter: blur(10px);
			}
		</style>
	</head>
	<body class="text-slate-300">
		<div
			id="top-bar"
			class="hidden fixed top-4 left-1/2 -translate-x-1/2 z-50 flex items-center gap-6"
		>
			<div
				id="timer-display"
				class="bg-slate-900/80 border border-slate-700 text-cyan-300 font-mono text-2xl py-2 px-6 rounded-lg"
			>
				01:00:00
			</div>
			<div
				id="score-display"
				class="bg-slate-900/80 border border-slate-700 text-amber-300 font-mono text-2xl py-2 px-6 rounded-lg"
			>
				Score: 0
			</div>
		</div>

		<div id="main-content">
			<div class="container mx-auto px-4 py-8 md:py-12">
				<header class="text-center mb-10 md:mb-16 relative mt-16">
					<div
						class="flex justify-center items-center gap-x-6 mb-4"
					>
						<img
							src="https://www.ctuniversity.in/images/logo/Ct_logo.png"
							alt="CT University Logo"
							class="h-16 w-auto"
						/>
						<img
							src="soet.png"
							alt="SOET Logo"
							class="h-16 w-auto"
						/>
					</div>
                <h1 class="text-4xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-teal-300 mb-2">
                    C++ Debugging Arena
                </h1>
                <p class="text-lg text-slate-300 mt-2 mb-4">Organized by <span class="font-semibold text-cyan-400">Tech Verse, CT University</span></p>
                <p class="text-slate-400 max-w-2xl mx-auto">
                    Welcome, challenger! Your mission is to find and fix the bugs. May your logic be sound and your syntax true.
                </p>
            </header>

            <!-- Filters -->
            <div class="flex justify-center items-center gap-2 md:gap-4 mb-12" id="filter-container">
                <button class="filter-btn active py-2 px-4 rounded-full bg-slate-800 hover:bg-slate-700 border border-slate-700 text-sm md:text-base" data-filter="all">All Levels</button>
                <button class="filter-btn py-2 px-4 rounded-full bg-slate-800 hover:bg-slate-700 border border-slate-700 text-sm md:text-base" data-filter="easy">Easy</button>
                <button class="filter-btn py-2 px-4 rounded-full bg-slate-800 hover:bg-slate-700 border border-slate-700 text-sm md:text-base" data-filter="intermediate">Intermediate</button>
                <button class="filter-btn py-2 px-4 rounded-full bg-slate-800 hover:bg-slate-700 border border-slate-700 text-sm md:text-base" data-filter="hard">Hard</button>
            </div>
            
            <!-- Submit Button -->
            <div id="submit-container" class="text-center mb-12 hidden">
                <button id="submit-challenge-btn" class="bg-rose-600 hover:bg-rose-700 text-white font-bold py-3 px-8 rounded-lg text-lg shadow-lg shadow-rose-500/30 transition-transform hover:scale-105">
                    End & Submit Challenge
                </button>
            </div>

            <!-- Challenges Grid -->
            <div id="challenges-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Cards will be dynamically populated by JS -->
            </div>
        </div>
    </div>

    <!-- Solver Modal -->
    <div id="solver-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="bg-slate-800 border border-slate-700 rounded-lg shadow-xl w-full max-w-4xl max-h-full overflow-y-auto p-6 relative">
            <button id="close-modal-btn" class="absolute top-4 right-4 text-slate-400 hover:text-white">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <h2 id="modal-title" class="text-2xl font-bold text-cyan-400 mb-2">Challenge Title</h2>
            <p id="modal-description" class="text-slate-400 mb-6">Challenge description goes here.</p>
            
            <div class="mb-4">
                <label for="code-editor" class="block text-sm font-medium text-slate-300 mb-2">C++ Code Snippet</label>
                <textarea id="code-editor" class="code-editor w-full p-4" spellcheck="false"></textarea>
            </div>

            <div class="flex items-center gap-4 mb-4">
                 <button id="run-code-btn" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-6 rounded-md flex items-center gap-2">
                    <i data-lucide="play" class="w-5 h-5"></i>
                    Run Code
                </button>
            </div>

            <div>
                <label for="output-area" class="block text-sm font-medium text-slate-300 mb-2">Output</label>
                <pre id="output-area" class="output-area p-4"></pre>
            </div>
        </div>
    </div>

    <!-- Start Overlay -->
    <div id="start-overlay" class="fixed inset-0 z-40 flex flex-col items-center justify-center text-center p-4">
        <h1 class="text-5xl font-bold text-white mb-4">C++ Debugging Competition</h1>
        <p class="text-slate-300 text-lg max-w-xl mb-8">You will have 1 hour to solve the challenges. The timer starts when you click the button below. The window will enter fullscreen mode. Exiting fullscreen will result in disqualification.</p>
        <button id="start-btn" class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-4 px-10 rounded-lg text-2xl shadow-lg shadow-cyan-500/30 transition-transform hover:scale-105">
            Start Competition
        </button>
    </div>

    <!-- Disqualified Overlay -->
    <div id="disqualified-overlay" class="hidden fixed inset-0 z-50 flex flex-col items-center justify-center text-center p-4 whitespace-pre-wrap">
         <i data-lucide="shield-off" class="w-24 h-24 text-rose-500 mb-6"></i>
        <h1 class="text-6xl font-bold text-rose-500 mb-4">Challenge Ended</h1>
        <p class="text-slate-300 text-xl max-w-xl">You have exited fullscreen mode, and your session has been terminated.</p>
    </div>


    <script>
        // --- Global State ---
        let competitionStarted = false;
        let timerInterval;
        let currentChallengeId = null;

        // --- DOM Elements ---
        const mainContent = document.getElementById('main-content');
        const startOverlay = document.getElementById('start-overlay');
        const startBtn = document.getElementById('start-btn');
        const topBar = document.getElementById('top-bar');
        const timerDisplay = document.getElementById('timer-display');
        const scoreDisplay = document.getElementById('score-display');
        const disqualifiedOverlay = document.getElementById('disqualified-overlay');
        const submitContainer = document.getElementById('submit-container');
        const submitBtn = document.getElementById('submit-challenge-btn');

        const challenges = {
            'larger-number': { title: 'Print Larger Number', description: 'This code should print the larger of two numbers, but it has multiple logical and syntax errors.', level: 'easy', points: 100, buggyCode: `#inlcude <iostream>\nusing namespace std;\nint main() {\n    int a, b;\n    cout << "Enter two numbers: ";\n    cin >> a;\n    if(a > b);\n        cout << "Max = " << b;\n    else\n        cout << "Max = " << a << endl;\n    return 0\n}`},
            'factorial': { title: 'Factorial Calculation', description: 'Calculate the factorial of a number. The initial value for the factorial calculation is incorrect.', level: 'easy', points: 100, buggyCode: `#include <iostream>\nusing namespace std;\nint main() {\n    int n = 5;\n    int fact = 0;\n    for(int i = 1; i <= n; i++) {\n        fact = fac * i;\n    }\n    cout << "Factorial of " << n << " is " << fact << endl\n    return 0;\n}`},
            'reverse-digits': { title: 'Reverse Digits', description: 'The logic to reverse a number is flawed and contains syntax errors. Can you fix it?', level: 'easy', points: 100, buggyCode: `#include <iostream>\nusing namespace std;\nint main{ \n    int n, rev = 0;\n    cout << "Enter number: ";\n    cin << n;\n    while(n > 0) {\n        int digit = n % 10;\n        rev = rev * 10 + digit;\n        n = n / 100;\n    }\n    cout << "Reverse = " << rev << endl\n    return 0\n}`},
            'sum-n-numbers': { title: 'Sum of N Numbers', description: 'This snippet to sum the first "n" numbers isn\'t working due to uninitialized variables and syntax issues.', level: 'easy', points: 100, buggyCode: `#include <iostream>\nusing namespace std;\nint main() {\n    int n = 10;\n    int sum;\n    for(int i = 1; i <= n; i+) {\n        sum = sum + i;\n    }\n    cout << "Sum of first " << m << " numbers is " << sum << endl;\n    return 0;\n}`},
            'print-odd': { title: 'Print Odd Numbers', description: 'The goal is to print the first "n" odd numbers, but it\'s printing even numbers instead.', level: 'easy', points: 100, buggyCode: `#include <iostream>\nusing namespace std;\nint main() {\n    int n;\n    cuot >> "Enter n: ";\n    cin << n;\n    for(int i=1; i<=n; i++) {\n        cout << 2*i << " ";\n    }\n    cout << endl;\n    retrun 0;\n}`},
            'array-average': { title: 'Array Average', description: 'An incorrect array size and loop condition lead to an out-of-bounds error when calculating the average.', level: 'easy', points: 100, buggyCode: `#include <iostream>\nusing namespace std;\nint main() {\n    int arr[4] = {10, 20, 30, 40, 50};\n    int sum = 0;\n    for(int i = 0; i <= 5; i++) {\n        sum += arr[i];\n    }\n    cout << "Average = " << s / 5 << endl;\n    return 0;\n}`},
            'fibonacci': { title: 'Recursive Fibonacci', description: 'A recursive function to generate the Fibonacci series has a faulty recursive call and other errors.', level: 'intermediate', points: 250, buggyCode: `#include <istream>\nusing namepace std;\nint fib(int n){\n    if(n == 0) return 0;\n    else if(n == 1) return 1;\n    else return fb(n-1) + fb(n+2);\n}\nint main(){\n    cout << "Enter number of terms: ";\n    cin >> terms;\n    for(int i=0; i<=terms; i++){\n        cout << fib(i) << " ";\n    }\n    return 0;\n}`},
            'linked-list': { title: 'Linked List Insertion', description: 'Inserting a node at the end of a linked list is failing due to multiple pointer and logic errors.', level: 'intermediate', points: 250, buggyCode: `#include <iostream>\nusing namespace std;\nstruct Node {\n    int data;\n    Node^ next;\n};\nvoid insert(Node*& head, int value) {\n    Node* newNode = new Node();\n    newNode->data == value;\n    if (head = nullptr) {\n        head = newNode;\n    } else {\n        Node* temp = head;\n        while (temp->next = nullptr) {\n            temp = temp->next;\n        }\n        temp->next == newNode;\n    }\n}\nvoid display(Node* head) {\n    Node* temp = head->next;\n    while (temp != nullptr) {\n        cout << temp->data << " -> ";\n        temp = temp->next;\n    }\n    cout << "null" << endl;\n}\nint main() {\n    Node* head = NULL;\n    insert(head, 10);\n    insert(head, 20);\n    display(Head);\n    return 0;\n}`},
            'palindrome-sum': { title: 'Palindrome & Even Sum', description: 'Two functions, one to sum even numbers and another to check for a palindrome, are riddled with bugs.', level: 'intermediate', points: 250, buggyCode: `#include <iostream>\n#include <vector>\n#include <string>\nusing namespace std;\nint sumEvenNumbers(vector<int> numbers); {\n    int sum = 0;\n    for (int i = 0; i < numbers.size; i++); {\n        if (numbers[i] % 2 = 0) {\n            sum =+ numbers[i];\n        }\n    }\n    return sum;\n}\nbool is_palindrome(string& s) {\n    int left = 0;\n    int right = s.length() - 1;\n    while (left < right) {\n        if (s[left] != s[right]) {\n            return false\n        }\n        left--;\n        right++;\n    }\n    return true;\n}\nint main() {\n    vector<int> my_numbers = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10};\n    int total_even = sumEvenNumbers(my_numbers);\n    cout << "The sum of even numbers is: " + total_even << endl;\n    string test_string = "racecar";\n    if (is_palindrome(test_string)) {\n        cout << test_string << " is a palindrome." << endl;\n    } else {\n        cout << test_string << " is not a palindrome." << endl;\n    }\n    return 0;\n}`},
            'sales-calc': { title: 'Sales Data Analysis', description: 'This program to compute sales data is broken due to uninitialized variables, off-by-one errors, and logical mistakes.', level: 'hard', points: 500, buggyCode: `#include <iostream>\n#include <string>\nusing namespace std;\nint main() {\n    int n;\n    cout << "Enter number of salespersons: ";\n    cin >> n;\n    string names[n];\n    double sales[n];\n    double totalSales;\n    double maxSales, minSales;\n    int maxIndex, minIndex;\n    for(int i = 0; i <= n; i++) {\n        cout << "Enter name of salesperson " << i+1 << ": ";\n        cin >> names[i];\n        cout << "Enter sales amount: ";\n        cin >> sales[i];\n        totalSales = totalSales + sales[i];\n    }\n    maxSales = sales[0];\n    minSales = sales[0];\n    for(int i = 0; i < n; i++) {\n        if(sales[i] > maxSales) {\n            maxSales = sales[i];\n            maxIndex = j;\n        }\n        if(sales[i] < minSales)\n            minSales = sales[i];\n    }\n    double avg = totalSales / n;\n    cout << "Average sales = " << average << endl;\n    cout << "Top salesperson: " << names[maxSales] << " with sales " << maxSales << endl;\n    cout << "Lowest salesperson: " << names[minSales] << " with sales " << minSales << endl;\n    if(avg > 10000)\n        cout << "Excellent month!";\n    else\n        cout << "Needs improvement!" << endl;\n    return 0;\n}`}
        };

        // --- Initial Setup ---
        window.onload = () => {
            mainContent.classList.add('content-blur');
            populateChallengeGrid();
            lucide.createIcons();
        };

        function createCardHTML(id, title, level, points, description) {
            const levelColors = { easy: { tag: 'tag-easy', text: 'cyan', button: 'cyan' }, intermediate: { tag: 'tag-intermediate', text: 'amber', button: 'amber' }, hard: { tag: 'tag-hard', text: 'rose', button: 'rose' } };
            const colors = levelColors[level];
            return `<div class="card rounded-lg overflow-hidden" data-level="${level}" data-challenge="${id}"><div class="p-6"><div class="flex justify-between items-start mb-4"><h3 class="text-lg font-semibold text-slate-100">${title}</h3><span class="${colors.tag} text-xs font-bold px-2 py-1 rounded-full capitalize">${level}</span></div><p class="text-sm text-slate-400 mb-4">${description}</p><div class="flex justify-between items-center"><span class="font-mono text-${colors.text}-400 text-lg">${points} pts</span><button class="solve-btn bg-${colors.button}-600 hover:bg-${colors.button}-700 text-white py-2 px-4 rounded-md font-semibold text-sm">Solve</button></div></div></div>`;
        }
        
        const challengesGrid = document.getElementById('challenges-grid');
        function populateChallengeGrid() {
            challengesGrid.innerHTML = ''; // Clear existing cards
            for (const id in challenges) {
                const ch = challenges[id];
                challengesGrid.innerHTML += createCardHTML(id, ch.title, ch.level, ch.points, ch.description);
            }
        }

        // --- Competition Logic ---
        startBtn.addEventListener('click', () => {
            document.documentElement.requestFullscreen().then(() => {
                competitionStarted = true;
                startOverlay.classList.add('hidden');
                mainContent.classList.remove('content-blur');
                topBar.classList.remove('hidden');
                submitContainer.classList.remove('hidden');
                
                // Initialize session storage for score
                sessionStorage.setItem('score', '0');
                sessionStorage.setItem('solvedChallenges', JSON.stringify([]));
                updateScoreDisplay(0);

                startTimer(3600); // 1 hour in seconds
                setupSecurityListeners();
            }).catch(err => {
                alert(`Error entering fullscreen. Please allow fullscreen mode to start the competition. Error: ${err.message}`);
            });
        });
        
        submitBtn.addEventListener('click', () => {
            if (competitionStarted) {
                const finalScore = sessionStorage.getItem('score') || 0;
                disqualify(`Challenge Submitted!\nYour final score is ${finalScore}.`);
            }
        });


        function startTimer(duration) {
            let timeLeft = duration;
            timerInterval = setInterval(() => {
                timeLeft--;
                const hours = Math.floor(timeLeft / 3600);
                const minutes = Math.floor((timeLeft % 3600) / 60);
                const seconds = timeLeft % 60;
                timerDisplay.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    const finalScore = sessionStorage.getItem('score') || 0;
                    disqualify(`Time's Up!\nYour final score is ${finalScore}.`);
                }
            }, 1000);
        }
        
        function updateScoreDisplay(score) {
            scoreDisplay.textContent = `Score: ${score}`;
        }

        function markChallengeAsSolved(challengeId) {
            const card = document.querySelector(`.card[data-challenge="${challengeId}"]`);
            if (card) {
                card.classList.add('solved');
            }
        }

        function disqualify(reason = "You have exited fullscreen mode, and your session has been terminated.") {
            clearInterval(timerInterval);
            competitionStarted = false;
            mainContent.classList.add('hidden');
            topBar.classList.add('hidden');
            const modal = document.getElementById('solver-modal');
            modal.classList.add('hidden');
            
            disqualifiedOverlay.querySelector('p').textContent = reason;
            disqualifiedOverlay.classList.remove('hidden');

            if (document.fullscreenElement) {
                document.exitFullscreen();
            }
        }

        // --- Security Measures ---
        function setupSecurityListeners() {
            document.addEventListener('fullscreenchange', () => {
                if (!document.fullscreenElement && competitionStarted) disqualify();
            });
            document.addEventListener('keydown', (e) => {
                if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && ['I', 'J', 'C'].includes(e.key.toUpperCase())) || (e.ctrlKey && ['U', 'S'].includes(e.key.toUpperCase()))) {
                    e.preventDefault();
                }
            });
            document.addEventListener('contextmenu', (e) => e.preventDefault());
            const initialHeight = window.outerHeight;
            window.addEventListener('resize', () => {
                if (competitionStarted && window.outerHeight < initialHeight - 150) {
                    disqualify("Developer tools detected. Session terminated.");
                }
            });
        }

        // --- Filtering Logic ---
        const filterContainer = document.getElementById('filter-container');
        filterContainer.addEventListener('click', (event) => {
            const target = event.target.closest('.filter-btn');
            if (!target) return;
            filterContainer.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            target.classList.add('active');
            const filter = target.dataset.filter;
            document.querySelectorAll('#challenges-grid .card').forEach(card => {
                card.style.display = (filter === 'all' || card.dataset.level === filter) ? 'block' : 'none';
            });
        });

        // --- Modal & Compiler Logic ---
        const modal = document.getElementById('solver-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const runCodeBtn = document.getElementById('run-code-btn');
        const codeEditor = document.getElementById('code-editor');
        const outputArea = document.getElementById('output-area');
        
        challengesGrid.addEventListener('click', (event) => {
            const solveBtn = event.target.closest('.solve-btn');
            if (!solveBtn || !competitionStarted) return;
            const card = solveBtn.closest('.card');
            currentChallengeId = card.dataset.challenge;
            const challenge = challenges[currentChallengeId];
            if (!challenge) return;
            document.getElementById('modal-title').textContent = challenge.title;
            document.getElementById('modal-description').textContent = challenge.description;
            codeEditor.value = challenge.buggyCode;
            outputArea.textContent = 'Click "Run Code" to compile and execute.';
            outputArea.style.color = '#94a3b8'; // slate-400
            modal.classList.remove('hidden');
        });

        closeModalBtn.addEventListener('click', () => modal.classList.add('hidden'));
        modal.addEventListener('click', (event) => {
            if (event.target === modal) modal.classList.add('hidden');
        });

        runCodeBtn.addEventListener('click', async () => {
            const userCode = codeEditor.value;
            outputArea.style.color = '#fef3c7'; // amber-100
            outputArea.textContent = 'Sending to compiler...';
            runCodeBtn.disabled = true;
            const payload = { code: userCode, compiler: "gcc-head", options: "-Wall,-Wextra,-pedantic,-std=c++20" };
            try {
                const response = await fetch('https://wandbox.org/api/compile.json', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const result = await response.json();
                
                let outputText = "";
                if (result.compiler_error || result.program_error) {
                    outputArea.style.color = '#fecdd3'; // rose-200
                    outputText = `Error:\n-----\n${result.compiler_error || result.program_error}`;
                } else {
                    outputArea.style.color = '#a7f3d0'; // emerald-200
                    outputText = `Compilation Successful!\n\nOutput:\n------\n${result.program_message || '(No output)'}`;
                    
                    // --- Scoring Logic ---
                    let solvedChallenges = JSON.parse(sessionStorage.getItem('solvedChallenges')) || [];
                    if (!solvedChallenges.includes(currentChallengeId)) {
                        solvedChallenges.push(currentChallengeId);
                        sessionStorage.setItem('solvedChallenges', JSON.stringify(solvedChallenges));

                        let currentScore = parseInt(sessionStorage.getItem('score'), 10) || 0;
                        const points = challenges[currentChallengeId].points;
                        currentScore += points;
                        sessionStorage.setItem('score', currentScore);

                        updateScoreDisplay(currentScore);
                        markChallengeAsSolved(currentChallengeId);
                        outputText += `\n\n+${points} points! Challenge complete.`;
                    } else {
                         outputText += `\n\n(Challenge already solved)`;
                    }
                }
                outputArea.textContent = outputText;

            } catch (error) {
                outputArea.style.color = '#fecdd3'; // rose-200
                outputArea.textContent = `Network or API Error:\n-----\n${error.message}`;
                console.error("Error calling Wandbox API:", error);
            } finally {
                runCodeBtn.disabled = false;
            }
        });
    </script>
</body>
</html>

